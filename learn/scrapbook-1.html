<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Cappuccino - Scrapbook #1 - Views and Layers</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<link href="/img/favicon.ico" rel="shortcut icon">
<link href="/css/main-6ee61d5e.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,900,300italic,400italic,700italic,900italic" rel="stylesheet" type="text/css">
<link href="/blog/feed.xml" rel="alternate" title="Cappuccino Blog Feed" type="application/atom+xml">
</head>
<body class="file-scrapbook-1-html folder-learn">
<a class="scrolltop" href="#">
<span>up</span>
</a>
<div class="navbar navbar-fixed-top">
<div class="navbar-inner">
<div class="container">
<a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</a>
<a class="brand" href="/">
<img alt="logo" src="/img/cappuccino-website-logo-333bd6a0.png">
</a>
<div class="nav-collapse collapse">
<ul class="nav pull-right">
<li>
<a class="scroller" href="/#features">Features</a>
</li>
<li>
<a class="scroller" href="/downloads.html#download">Download</a>
</li>
<li>
<a href="/learn/">Learn</a>
</li>
<li>
<a href="/contribute.html">Contribute</a>
</li>
<li>
<a href="/blog/">Blog</a>
</li>
<li>
<a href="/learn/documentation/">API</a>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="container learn">
<h2 class="section_header">
<hr class="left visible-desktop">
<span>Learn</span>
<hr class="right visible-desktop">
</h2>
<div class="row">
<div class="span3">
<ul class="nav nav-tabs nav-stacked">
<li>
<a href="/learn/">What is Cappuccino?</a>
</li>
<li>
<a href="/learn/environment.html">Your development environment</a>
</li>
<li>
<a href="/learn/starter.html">Get Started</a>
</li>
<li>
<a href="/learn/build-source.html">Advanced: Install from Source</a>
</li>
<li>
<a href="/learn/objective-j.html">Learning Objective-J</a>
</li>
<li class="active">
<a href="/learn/scrapbook-1.html">Scrapbook #1 - Views and Layers</a>
</li>
<li>
<a href="/learn/scrapbook-2.html">Scrapbook #2 - Drag and Drop</a>
</li>
<li>
<a href="/learn/automatic-layout.html">Tutorial: Automatic Layout</a>
</li>
<li>
<a href="/learn/xcode-basics.html">Tutorial: Xcode Interface Builder</a>
</li>
<li>
<a href="/learn/simple-tableview.html">Tutorial: Simple Table View</a>
</li>
<li>
<a href="/learn/simple-outlineview.html">Tutorial: Simple Outline View</a>
</li>
<li>
<a href="/learn/debugging.html">Debugging</a>
</li>
<li>
<a href="/learn/ojtest.html">Testing with OJTest</a>
</li>
<li>
<a href="/learn/cucapp.html">Testing with Cucapp</a>
</li>
</ul>
<h5>Resources</h5>
<ul class="nav nav-tabs nav-stacked">
<li>
<a href="/learn/demos.html">Demos</a>
</li>
<li>
<a href="/learn/documentation/">API Documentation</a>
</li>
<li>
<a href="/support/faq.html">FAQ</a>
</li>
</ul>
</div>
<div class="span9 text-body markdown">
<h3>
Scrapbook #1 - Views and Layers
</h3>
<h3>An introduction to Cappuccino Graphics</h3>

<p>This tutorial is the first in a multi-part series in which we will be
building a full featured Scrapbooking application, complete with backend
storage. The goal of these tutorials is to start off simple and
incrementally add features, mimicking the development of a real world
application and allowing us to focus on different aspects of Cappuccino
along the way. For this first installment, we will be getting familiar
with Cappuccino’s view hierarchy and graphics subsystem.</p>

<h3>The Idea</h3>

<p>Before we jump into any serious programming, let’s begin by getting a
good idea of what we’re building. The goal of the scrapbook application
is to provide users with a place to arrange their photos into albums.
These albums will have different themes and allow users to insert,
scale, rotate, and crop their images. When done, they will be able to
save and share their albums.</p>

<p>As I mentioned earlier, we will be focusing on some of the core
graphical aspects of this application right now, and saving most of the
overall design decisions of this application for later. So the very
first thing we’re going to tackle is building a solid UI for scaling and
cropping images. The plan is to present the user with a few controls in
a heads up display which will allow them to manipulate selected images,
and then go away when the user is done editing. You can see a working
example of this <a href="/learn/demos/Scrapbook/Part%201/index-debug.html">here</a>. You should
take a few minutes to play around with it and get an idea of what we
will be building. You can also view or download the entire source of the
application <a href="https://github.com/cappuccino/cappuccino-demos/tree/master/Scrapbook/Part%201">here</a> if you
prefer to follow along with the code.</p>

<p><img alt="Completed App" width="600" height="454" src="/img/scrapbook-1-completed-dfd99dfc.png"></p>

<h3>Setting Up the Project</h3>

<p>Since we’re not doing anything too complex yet, we’re going to build off
of the <a href="/downloads.html">Starter Template</a>. Open up <code>AppController.j</code> and
delete all the code relating to the HelloWorld textfield, such that all
that is left in <code>applicationDidFinishLaunching:</code> is the following:</p>

<div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">applicationDidFinishLaunching:</span><span class="p">(</span><span class="kt">CPNotification</span><span class="p">)</span>aNotification
<span class="p">{</span>
    <span class="kd">var</span> <span class="n">theWindow</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPWindow</span> <span class="n">alloc</span><span class="p">]</span>
                        <span class="n">initWithContentRect</span><span class="o">:</span><span class="nf">CGRectMakeZero</span><span class="p">()</span>
                        <span class="n">styleMask</span><span class="o">:</span><span class="n">CPBorderlessBridgeWindowMask</span><span class="p">],</span>
        <span class="n">contentView</span> <span class="o">=</span> <span class="p">[</span><span class="n">theWindow</span> <span class="n">contentView</span><span class="p">];</span>

    <span class="p">[</span><span class="n">theWindow</span> <span class="n">orderFront</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>If you now rerun this application by hitting refresh, you will see that
nothing shows up on the screen. So let’s take a moment to understand
what is going on in these very few lines of code.</p>

<p>In Cappuccino, all view hierarchies start from within a <code>CPWindow</code>. So
to get anything to display on the screen, we first require the creation
of a window. <code>CPWindow</code>s should not be confused with the browser window
however. <code>CPWindow</code>s exist within the main browser window, and there can
be multiple of them. The relationship between <code>CPWindow</code> and the browser
window is similar to that between Desktop windows and the screen. In
Cappuccino, we often refer to the browser window as the <code>bridge</code>,
since the browser window bridges the web to the desktop.</p>

<p>When you create a <code>CPWindow</code>, you generally specify the content
rectangle and style mask. The content rectangle describes the position
and size of the inner content ignoring the chrome around it. The style
mask describes the chrome, or look, of the window. In this case, we are
creating a window with the “borderless bridge” look. The borderless
bridge style describes a <code>CPWindow</code> with no chrome at all, and that
takes up the entire size of the browser window, which is why we don’t
bother sending a meaningful value in for the content rectangle – it
gets set automatically for us. The <code>CPBorderlessWindowMask</code> is similar
to this, but does not follow the size of the browser window.</p>

<p>Now, the <code>contentView</code> of a <code>CPWindow</code> is the root view class of a
window. This is where you will be putting all of your custom UI, such as
buttons, text fields, etc. Let’s go ahead and set the color of our
content view to be black by adding this code right after the
declaration:</p>

<div class="highlight"><pre><span class="p">[</span><span class="n">contentView</span> <span class="n">setBackgroundColor</span><span class="o">:</span><span class="p">[</span><span class="n">CPColor</span> <span class="n">blackColor</span><span class="p">]];</span>
</pre></div>

<p>If you refresh now, you’ll see that the entire browser window has turned
black. This is because, as we described earlier, borderless bridge
windows “fit” their parent browser windows.</p>

<h3>Photo Inspector</h3>

<p>Since we’re on the topic of windows, let’s go ahead and make our
heads-up-display (HUD) controller that we mentioned earlier. First,
let’s just make a HUD panel. A panel is a type of window that floats on
top of other windows. Create a panel in the <code>applicationDidFinishLaunching:</code> method:</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="n">HUDPanel</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPPanel</span> <span class="n">alloc</span><span class="p">]</span>
    <span class="n">initWithContentRect</span><span class="o">:</span><span class="nf">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">125</span><span class="p">)</span>
    <span class="n">styleMask</span><span class="o">:</span><span class="n">CPHUDBackgroundWindowMask</span> <span class="o">|</span> <span class="n">CPClosableWindowMask</span><span class="p">];</span>

<span class="p">[</span><span class="n">HUDPanel</span> <span class="n">setFloatingPanel</span><span class="o">:</span><span class="kc">YES</span><span class="p">];</span>

<span class="p">[</span><span class="n">HUDPanel</span> <span class="n">orderFront</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>
</pre></div>

<p>Now if you refresh, you’ll see a little HUD panel show up at the top
left corner of your screen. You can drag on it to move it around, and
click on the close box to close it. As you can see, in this case we
specified an actual content rectangle since we aren’t relying on the
panel simply stretching to the entire size of the bridge. We chose two
style masks in this case: <code>CPHUDBackgroundWindowMask</code> and
<code>CPClosableWindowMask</code>. <code>CPHUDBackgroundWindowMask</code> notifies our
panel that we want the HUD look, and <code>CPClosableWindowMask</code> lets the
panel know that it should display its close box. If you remove the
<code>CPClosableWindowMask</code> mask, you will no longer be able to close the
panel.</p>

<p><img width="600" height="454" src="/img/scrapbook-1-just-inspector-77d334fd.png"></p>

<p>Let’s start giving the panel some contents. The easiest thing to add is
a title:</p>

<div class="highlight"><pre><span class="p">[</span><span class="n">HUDPanel</span> <span class="n">setTitle</span><span class="o">:</span><span class="s">"Inspector"</span><span class="p">];</span>
</pre></div>

<p>We will now add our two sliders to control the scale and rotation of our
photos. To do this we will use the <code>CPSlider</code> class. Just as we did with
the main window, we will grab the contentView of the HUD panel to place
these sliders in:</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="n">panelContentView</span> <span class="o">=</span> <span class="p">[</span><span class="n">HUDPanel</span> <span class="n">contentView</span><span class="p">],</span>
    <span class="n">centerX</span> <span class="o">=</span> <span class="p">(</span><span class="nf">CGRectGetWidth</span><span class="p">([</span><span class="n">panelContentView</span> <span class="n">bounds</span><span class="p">])</span> <span class="o">-</span> <span class="mf">135.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">;</span>

<span class="kd">var</span> <span class="n">scaleSlider</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPSlider</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">initWithFrame</span><span class="o">:</span><span class="nf">CGRectMake</span><span class="p">(</span><span class="n">centerX</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">135.0</span><span class="p">,</span> <span class="mf">24.0</span><span class="p">)];</span>

<span class="p">[</span><span class="n">scaleSlider</span> <span class="n">setMinValue</span><span class="o">:</span><span class="mi">50</span><span class="p">];</span>
<span class="p">[</span><span class="n">scaleSlider</span> <span class="n">setMaxValue</span><span class="o">:</span><span class="mi">150</span><span class="p">];</span>
<span class="p">[</span><span class="n">scaleSlider</span> <span class="n">setValue</span><span class="o">:</span><span class="mi">100</span><span class="p">];</span>

<span class="p">[</span><span class="n">panelContentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">scaleSlider</span><span class="p">];</span>

<span class="kd">var</span> <span class="n">scaleStartLabel</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="n">labelWithTitle</span><span class="o">:</span><span class="s">"50%"</span><span class="p">],</span>
    <span class="n">scaleEndLabel</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="n">labelWithTitle</span><span class="o">:</span><span class="s">"150%"</span><span class="p">];</span>

<span class="p">[</span><span class="n">scaleStartLabel</span> <span class="n">setFrameOrigin</span><span class="o">:</span><span class="nf">CGPointMake</span><span class="p">(</span>
    <span class="n">centerX</span> <span class="o">-</span> <span class="nf">CGRectGetWidth</span><span class="p">([</span><span class="n">scaleStartLabel</span> <span class="n">frame</span><span class="p">]),</span> <span class="mi">10</span><span class="p">)];</span>
<span class="p">[</span><span class="n">scaleEndLabel</span> <span class="n">setFrameOrigin</span><span class="o">:</span>
    <span class="nf">CGPointMake</span><span class="p">(</span><span class="nf">CGRectGetMaxX</span><span class="p">([</span><span class="n">scaleSlider</span> <span class="n">frame</span><span class="p">]),</span> <span class="mi">10</span><span class="p">)];</span>

<span class="p">[</span><span class="n">panelContentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">scaleStartLabel</span><span class="p">];</span>
<span class="p">[</span><span class="n">panelContentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">scaleEndLabel</span><span class="p">];</span>

<span class="n">rotationSlider</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPSlider</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">initWithFrame</span><span class="o">:</span>
    <span class="nf">CGRectMake</span><span class="p">(</span><span class="n">centerX</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">24</span><span class="p">)];</span>

<span class="p">[</span><span class="n">rotationSlider</span> <span class="n">setMinValue</span><span class="o">:</span><span class="mi">0</span><span class="p">];</span>
<span class="p">[</span><span class="n">rotationSlider</span> <span class="n">setMaxValue</span><span class="o">:</span><span class="mi">360</span><span class="p">];</span>
<span class="p">[</span><span class="n">rotationSlider</span> <span class="n">setValue</span><span class="o">:</span><span class="mi">0</span><span class="p">];</span>

<span class="p">[</span><span class="n">panelContentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">rotationSlider</span><span class="p">];</span>

<span class="kd">var</span> <span class="n">rotationStartLabel</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="n">labelWithTitle</span><span class="o">:</span><span class="s">"0\u00B0"</span><span class="p">],</span>
    <span class="n">rotationEndLabel</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="n">labelWithTitle</span><span class="o">:</span><span class="s">"360\u00B0"</span><span class="p">];</span>

<span class="p">[</span><span class="n">rotationStartLabel</span> <span class="n">setFrameOrigin</span><span class="o">:</span><span class="nf">CGPointMake</span><span class="p">(</span><span class="n">centerX</span> <span class="o">-</span> <span class="nf">CGRectGetWidth</span><span class="p">([</span><span class="n">rotationStartLabel</span> <span class="n">frame</span><span class="p">]),</span> <span class="mi">40</span><span class="p">)];</span>
<span class="p">[</span><span class="n">rotationEndLabel</span> <span class="n">setFrameOrigin</span><span class="o">:</span><span class="nf">CGPointMake</span><span class="p">(</span><span class="nf">CGRectGetMaxX</span><span class="p">([</span><span class="n">rotationSlider</span> <span class="n">frame</span><span class="p">]),</span> <span class="mi">40</span><span class="p">)];</span>

<span class="p">[</span><span class="n">panelContentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">rotationStartLabel</span><span class="p">];</span>
<span class="p">[</span><span class="n">panelContentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">rotationEndLabel</span><span class="p">];</span>
</pre></div>

<p>You’ll notice this makes use of the <code>labelWithTitle:</code> method that we
have not yet defined. Go ahead and define it in AppController like so:</p>

<div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="kt">CPTextField</span><span class="p">)</span><span class="nf">labelWithTitle:</span><span class="p">(</span><span class="kt">CPString</span><span class="p">)</span>aTitle
<span class="p">{</span>
    <span class="kd">var</span> <span class="n">label</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPTextField</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">initWithFrame</span><span class="o">:</span><span class="nf">CGRectMakeZero</span><span class="p">()];</span>

    <span class="p">[</span><span class="n">label</span> <span class="n">setStringValue</span><span class="o">:</span><span class="n">aTitle</span><span class="p">];</span>
    <span class="p">[</span><span class="n">label</span> <span class="n">setTextColor</span><span class="o">:</span><span class="p">[</span><span class="n">CPColor</span> <span class="n">whiteColor</span><span class="p">]];</span>

    <span class="p">[</span><span class="n">label</span> <span class="n">sizeToFit</span><span class="p">];</span>

    <span class="k">return</span> <span class="n">label</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>This may seem daunting, but it’s really not that complex. Let’s start by
analyzing the <code>labelWithTitle:</code> method. It should look familiar, since
it’s almost identical to the code that was in the original
implementation of <code>applicationDidFinishLaunching:</code>. All we are doing is
creating a text field, setting its text contents to be <code>aTitle</code>,
setting its text color to white, and finally sizing it appropriately and
returning it.</p>

<p>In the slider creation code we are creating two sliders: one to modify
scale and another for rotation, so we only really need to go over half
the code. We are making our sliders <strong>135 pixels</strong> wide, so begin by
calculating the center position in our panel’s content view. After we
have this, We create a new slider at this position. We then set three
important values for sliders: the minimum value, the maximum value, and
the current value. The minimum value is what the left hand side of the
slider represents, the maximum is what the right hand side represents,
and the current value is simply where the knob of the slider currently
resides. In this case of the <code>scaleSlider</code>, we want to be able to
scale our photos from 50% to 150%, and obviously we want them to begin
at 100%. With the rotationSlider, we want to go from 0 degrees to 360
degrees, and start at 0 degrees. To highlight these values, we create 2
labels for each slider to sit to the left and to the right of the
sliders. So, your code should now look like this:</p>

<div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">applicationDidFinishLaunching:</span><span class="p">(</span><span class="kt">CPNotification</span><span class="p">)</span>aNotification
<span class="p">{</span>
    <span class="kd">var</span> <span class="n">theWindow</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPWindow</span> <span class="n">alloc</span><span class="p">]</span>
                        <span class="n">initWithContentRect</span><span class="o">:</span><span class="nf">CGRectMakeZero</span><span class="p">()</span>
                        <span class="n">styleMask</span><span class="o">:</span><span class="n">CPBorderlessBridgeWindowMask</span><span class="p">],</span>
        <span class="n">contentView</span> <span class="o">=</span> <span class="p">[</span><span class="n">theWindow</span> <span class="n">contentView</span><span class="p">];</span>

    <span class="p">[</span><span class="n">theWindow</span> <span class="n">orderFront</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>

    <span class="kd">var</span> <span class="n">HUDPanel</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPPanel</span> <span class="n">alloc</span><span class="p">]</span>
        <span class="n">initWithContentRect</span><span class="o">:</span><span class="nf">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">125</span><span class="p">)</span>
        <span class="n">styleMask</span><span class="o">:</span><span class="n">CPHUDBackgroundWindowMask</span> <span class="o">|</span> <span class="n">CPClosableWindowMask</span><span class="p">];</span>

    <span class="p">[</span><span class="n">HUDPanel</span> <span class="n">setFloatingPanel</span><span class="o">:</span><span class="kc">YES</span><span class="p">];</span>

    <span class="p">[</span><span class="n">HUDPanel</span> <span class="n">orderFront</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>

    <span class="p">[</span><span class="n">HUDPanel</span> <span class="n">setTitle</span><span class="o">:</span><span class="s">"Inspector"</span><span class="p">];</span>

    <span class="kd">var</span> <span class="n">panelContentView</span> <span class="o">=</span> <span class="p">[</span><span class="n">HUDPanel</span> <span class="n">contentView</span><span class="p">],</span>
        <span class="n">centerX</span> <span class="o">=</span> <span class="p">(</span><span class="nf">CGRectGetWidth</span><span class="p">([</span><span class="n">panelContentView</span> <span class="n">bounds</span><span class="p">])</span>
        <span class="o">-</span> <span class="mi">135</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

    <span class="kd">var</span> <span class="n">scaleSlider</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPSlider</span> <span class="n">alloc</span><span class="p">]</span>
        <span class="n">initWithFrame</span><span class="o">:</span><span class="nf">CGRectMake</span><span class="p">(</span><span class="n">centerX</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">24</span><span class="p">)];</span>

    <span class="p">[</span><span class="n">scaleSlider</span> <span class="n">setMinValue</span><span class="o">:</span><span class="mi">50</span><span class="p">];</span>
    <span class="p">[</span><span class="n">scaleSlider</span> <span class="n">setMaxValue</span><span class="o">:</span><span class="mi">150</span><span class="p">];</span>
    <span class="p">[</span><span class="n">scaleSlider</span> <span class="n">setValue</span><span class="o">:</span><span class="mi">100</span><span class="p">];</span>

    <span class="p">[</span><span class="n">panelContentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">scaleSlider</span><span class="p">];</span>

    <span class="kd">var</span> <span class="n">scaleStartLabel</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="n">labelWithTitle</span><span class="o">:</span><span class="s">"50%"</span><span class="p">],</span>
        <span class="n">scaleEndLabel</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="n">labelWithTitle</span><span class="o">:</span><span class="s">"150%"</span><span class="p">];</span>

    <span class="p">[</span><span class="n">scaleStartLabel</span> <span class="n">setFrameOrigin</span><span class="o">:</span><span class="nf">CGPointMake</span><span class="p">(</span><span class="n">centerX</span> <span class="o">-</span>
        <span class="nf">CGRectGetWidth</span><span class="p">([</span><span class="n">scaleStartLabel</span> <span class="n">frame</span><span class="p">]),</span> <span class="mi">10</span><span class="p">)];</span>
    <span class="p">[</span><span class="n">scaleEndLabel</span> <span class="n">setFrameOrigin</span><span class="o">:</span>
        <span class="nf">CGPointMake</span><span class="p">(</span><span class="nf">CGRectGetMaxX</span><span class="p">([</span><span class="n">scaleSlider</span> <span class="n">frame</span><span class="p">]),</span> <span class="mi">10</span><span class="p">)];</span>

    <span class="p">[</span><span class="n">panelContentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">scaleStartLabel</span><span class="p">];</span>
    <span class="p">[</span><span class="n">panelContentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">scaleEndLabel</span><span class="p">];</span>

    <span class="n">rotationSlider</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPSlider</span> <span class="n">alloc</span><span class="p">]</span>
        <span class="n">initWithFrame</span><span class="o">:</span><span class="nf">CGRectMake</span><span class="p">(</span><span class="n">centerX</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">24</span><span class="p">)];</span>

    <span class="p">[</span><span class="n">rotationSlider</span> <span class="n">setMinValue</span><span class="o">:</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">[</span><span class="n">rotationSlider</span> <span class="n">setMaxValue</span><span class="o">:</span><span class="mi">360</span><span class="p">];</span>
    <span class="p">[</span><span class="n">rotationSlider</span> <span class="n">setValue</span><span class="o">:</span><span class="mi">0</span><span class="p">];</span>

    <span class="p">[</span><span class="n">panelContentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">rotationSlider</span><span class="p">];</span>

    <span class="kd">var</span> <span class="n">rotationStartLabel</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="n">labelWithTitle</span><span class="o">:</span><span class="s">"0\u00B0"</span><span class="p">],</span>
        <span class="n">rotationEndLabel</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="n">labelWithTitle</span><span class="o">:</span><span class="s">"360\u00B0"</span><span class="p">];</span>

    <span class="p">[</span><span class="n">rotationStartLabel</span> <span class="n">setFrameOrigin</span><span class="o">:</span><span class="nf">CGPointMake</span><span class="p">(</span><span class="n">centerX</span> <span class="o">-</span>
        <span class="nf">CGRectGetWidth</span><span class="p">([</span><span class="n">rotationStartLabel</span> <span class="n">frame</span><span class="p">]),</span> <span class="mi">40</span><span class="p">)];</span>
    <span class="p">[</span><span class="n">rotationEndLabel</span> <span class="n">setFrameOrigin</span><span class="o">:</span>
        <span class="nf">CGPointMake</span><span class="p">(</span><span class="nf">CGRectGetMaxX</span><span class="p">([</span><span class="n">rotationSlider</span> <span class="n">frame</span><span class="p">]),</span> <span class="mi">40</span><span class="p">)];</span>

    <span class="p">[</span><span class="n">panelContentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">rotationStartLabel</span><span class="p">];</span>
    <span class="p">[</span><span class="n">panelContentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">rotationEndLabel</span><span class="p">];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">CPTextField</span><span class="p">)</span><span class="nf">labelWithTitle:</span><span class="p">(</span><span class="kt">CPString</span><span class="p">)</span>aTitle
<span class="p">{</span>
    <span class="kd">var</span> <span class="n">label</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPTextField</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">initWithFrame</span><span class="o">:</span><span class="nf">CGRectMakeZero</span><span class="p">()];</span>

    <span class="p">[</span><span class="n">label</span> <span class="n">setStringValue</span><span class="o">:</span><span class="n">aTitle</span><span class="p">];</span>
    <span class="p">[</span><span class="n">label</span> <span class="n">setTextColor</span><span class="o">:</span><span class="p">[</span><span class="n">CPColor</span> <span class="n">whiteColor</span><span class="p">]];</span>

    <span class="p">[</span><span class="n">label</span> <span class="n">sizeToFit</span><span class="p">];</span>

    <span class="k">return</span> <span class="n">label</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></div>

<p>We now have a functioning panel, but it’s not much good to us here
within the <code>applicationDidFinishLaunching:</code> method. So let’s create a
new file called <code>PhotoInspector.j</code> to contain it.</p>

<p>In <code>PhotoInspector.j</code>, we will be creating a subclass of
<code>CPWindowController</code> to manage this panel. <code>CPWindowController</code>s are
designed to manage <code>CPWindow</code>s and their interactions with other
objects. Once we’ve create this class, we’ll move all the relevant code
to it, namely the <code>labelWithTitle</code> method and view creation code:</p>

<div class="highlight"><pre><span class="cp">@import</span> <span class="s2">&lt;AppKit/CPPanel.j&gt;</span>
<span class="cp">@import</span> <span class="s2">&lt;AppKit/CPWindowController.j&gt;</span>

<span class="k">@implementation</span> <span class="nc">PhotoInspector</span> <span class="o">:</span> <span class="nc">CPWindowController</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">init</span>
<span class="p">{</span>
    <span class="kd">var</span> <span class="n">theWindow</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPPanel</span> <span class="n">alloc</span><span class="p">]</span>
        <span class="n">initWithContentRect</span><span class="o">:</span><span class="nf">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">125</span><span class="p">)</span>
        <span class="n">styleMask</span><span class="o">:</span><span class="n">CPHUDBackgroundWindowMask</span> <span class="o">|</span> <span class="n">CPClosableWindowMask</span><span class="p">];</span>

    <span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="n">initWithWindow</span><span class="o">:</span><span class="n">theWindow</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="n">theWindow</span> <span class="n">setTitle</span><span class="o">:</span><span class="s">@"Inspector"</span><span class="p">];</span>
        <span class="p">[</span><span class="n">theWindow</span> <span class="n">setFloatingPanel</span><span class="o">:</span><span class="kc">YES</span><span class="p">];</span>

        <span class="kd">var</span> <span class="n">contentView</span> <span class="o">=</span> <span class="p">[</span><span class="n">theWindow</span> <span class="n">contentView</span><span class="p">],</span>
            <span class="n">centerX</span> <span class="o">=</span> <span class="p">(</span><span class="nf">CGRectGetWidth</span><span class="p">([</span><span class="n">contentView</span> <span class="n">bounds</span><span class="p">])</span> <span class="o">-</span> <span class="mi">135</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

        <span class="n">scaleSlider</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPSlider</span> <span class="n">alloc</span><span class="p">]</span>
            <span class="n">initWithFrame</span><span class="o">:</span><span class="nf">CGRectMake</span><span class="p">(</span><span class="n">centerX</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">24</span><span class="p">)];</span>

        <span class="p">[</span><span class="n">scaleSlider</span> <span class="n">setMinValue</span><span class="o">:</span><span class="mi">50</span><span class="p">];</span>
        <span class="p">[</span><span class="n">scaleSlider</span> <span class="n">setMaxValue</span><span class="o">:</span><span class="mi">150</span><span class="p">];</span>
        <span class="p">[</span><span class="n">scaleSlider</span> <span class="n">setValue</span><span class="o">:</span><span class="mi">100</span><span class="p">];</span>

        <span class="p">[</span><span class="n">contentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">scaleSlider</span><span class="p">];</span>

        <span class="kd">var</span> <span class="n">scaleStartLabel</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="n">labelWithTitle</span><span class="o">:</span><span class="s">"50%"</span><span class="p">],</span>
            <span class="n">scaleEndLabel</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="n">labelWithTitle</span><span class="o">:</span><span class="s">"150%"</span><span class="p">];</span>

        <span class="p">[</span><span class="n">scaleStartLabel</span> <span class="n">setFrameOrigin</span><span class="o">:</span><span class="nf">CGPointMake</span><span class="p">(</span><span class="n">centerX</span> <span class="o">-</span>
            <span class="nf">CGRectGetWidth</span><span class="p">([</span><span class="n">scaleStartLabel</span> <span class="n">frame</span><span class="p">]),</span> <span class="mi">10</span><span class="p">)];</span>
        <span class="p">[</span><span class="n">scaleEndLabel</span> <span class="n">setFrameOrigin</span><span class="o">:</span>
            <span class="nf">CGPointMake</span><span class="p">(</span><span class="nf">CGRectGetMaxX</span><span class="p">([</span><span class="n">scaleSlider</span> <span class="n">frame</span><span class="p">]),</span> <span class="mi">10</span><span class="p">)];</span>

        <span class="p">[</span><span class="n">contentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">scaleStartLabel</span><span class="p">];</span>
        <span class="p">[</span><span class="n">contentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">scaleEndLabel</span><span class="p">];</span>

        <span class="n">rotationSlider</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPSlider</span> <span class="n">alloc</span><span class="p">]</span>
            <span class="n">initWithFrame</span><span class="o">:</span><span class="nf">CGRectMake</span><span class="p">(</span><span class="n">centerX</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">24</span><span class="p">)];</span>

        <span class="p">[</span><span class="n">rotationSlider</span> <span class="n">setMinValue</span><span class="o">:</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">[</span><span class="n">rotationSlider</span> <span class="n">setMaxValue</span><span class="o">:</span><span class="mi">360</span><span class="p">];</span>
        <span class="p">[</span><span class="n">rotationSlider</span> <span class="n">setValue</span><span class="o">:</span><span class="mi">0</span><span class="p">];</span>

        <span class="p">[</span><span class="n">contentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">rotationSlider</span><span class="p">];</span>

        <span class="kd">var</span> <span class="n">rotationStartLabel</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="n">labelWithTitle</span><span class="o">:</span><span class="s">"0\u00B0"</span><span class="p">],</span>
            <span class="n">rotationEndLabel</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="n">labelWithTitle</span><span class="o">:</span><span class="s">"360\u00B0"</span><span class="p">];</span>

        <span class="p">[</span><span class="n">rotationStartLabel</span> <span class="n">setFrameOrigin</span><span class="o">:</span><span class="nf">CGPointMake</span><span class="p">(</span><span class="n">centerX</span> <span class="o">-</span>
            <span class="nf">CGRectGetWidth</span><span class="p">([</span><span class="n">rotationStartLabel</span> <span class="n">frame</span><span class="p">]),</span> <span class="mi">40</span><span class="p">)];</span>
        <span class="p">[</span><span class="n">rotationEndLabel</span> <span class="n">setFrameOrigin</span><span class="o">:</span>
            <span class="nf">CGPointMake</span><span class="p">(</span><span class="nf">CGRectGetMaxX</span><span class="p">([</span><span class="n">rotationSlider</span> <span class="n">frame</span><span class="p">]),</span> <span class="mi">40</span><span class="p">)];</span>

        <span class="p">[</span><span class="n">contentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">rotationStartLabel</span><span class="p">];</span>
        <span class="p">[</span><span class="n">contentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">rotationEndLabel</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">CPTextField</span><span class="p">)</span><span class="nf">labelWithTitle:</span><span class="p">(</span><span class="kt">CPString</span><span class="p">)</span>aTitle
<span class="p">{</span>
    <span class="kd">var</span> <span class="n">label</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPTextField</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">initWithFrame</span><span class="o">:</span><span class="nf">CGRectMakeZero</span><span class="p">()];</span>

    <span class="p">[</span><span class="n">label</span> <span class="n">setStringValue</span><span class="o">:</span><span class="n">aTitle</span><span class="p">];</span>
    <span class="p">[</span><span class="n">label</span> <span class="n">setTextColor</span><span class="o">:</span><span class="p">[</span><span class="n">CPColor</span> <span class="n">whiteColor</span><span class="p">]];</span>

    <span class="p">[</span><span class="n">label</span> <span class="n">sizeToFit</span><span class="p">];</span>

    <span class="k">return</span> <span class="n">label</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></div>

<p>As you can see very little of the code has changed. The only real
addition is calling <code>initWithWindow:</code> in the new <code>init</code> method. This is
the standard way to create window controllers. We can now modify our
AppController code to the following:</p>

<div class="highlight"><pre><span class="cp">@import</span> <span class="s2">&lt;Foundation/CPObject.j&gt;</span>
<span class="cp">@import</span> <span class="s2">"PhotoInspector.j"</span>

<span class="k">@implementation</span> <span class="nc">AppController</span> <span class="o">:</span> <span class="nc">CPObject</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">applicationDidFinishLaunching:</span><span class="p">(</span><span class="kt">CPNotification</span><span class="p">)</span>aNotification
<span class="p">{</span>
    <span class="kd">var</span> <span class="n">theWindow</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPWindow</span> <span class="n">alloc</span><span class="p">]</span>
                        <span class="n">initWithContentRect</span><span class="o">:</span><span class="nf">CGRectMakeZero</span><span class="p">()</span>
                        <span class="n">styleMask</span><span class="o">:</span><span class="n">CPBorderlessBridgeWindowMask</span><span class="p">],</span>
        <span class="n">contentView</span> <span class="o">=</span> <span class="p">[</span><span class="n">theWindow</span> <span class="n">contentView</span><span class="p">];</span>

    <span class="p">[</span><span class="n">contentView</span> <span class="n">setBackgroundColor</span><span class="o">:</span><span class="p">[</span><span class="n">CPColor</span> <span class="n">blackColor</span><span class="p">]];</span>

    <span class="p">[</span><span class="n">theWindow</span> <span class="n">orderFront</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>

    <span class="kd">var</span> <span class="n">theInspector</span> <span class="o">=</span> <span class="p">[[</span><span class="n">PhotoInspector</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>

    <span class="p">[</span><span class="n">theInspector</span> <span class="n">showWindow</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></div>

<p>This successfully encapsulates the inspector panel away. To bring it up
all we need to do now is call <code>showWindow:</code> on our <code>PhotoInspector</code>
class, which we inherit for free from <code>CPWindowController</code>. You’ll
notice we also had to include the <code>PhotoInspector</code> class’ file
<code>PhotoInspector.j</code>. We use quotes to include this file because it is
local, as opposed to the AppKit files which are in our default search
paths.</p>

<h3>Building the Beginnings of our PageView</h3>

<p>Now that we have a photo inspector, we need some photos to inspect. In
our product, Scrapbook will be represented as a series of pages. Each
page will contain a number of panes that each contain an image. These
pages will be represented by <code>PageView</code>s, so let’s start fleshing out
our <code>PageView</code> class in a file called <code>PageView.j</code>.</p>

<div class="highlight"><pre><span class="cp">@import</span> <span class="s2">&lt;AppKit/CPView.j&gt;</span>

<span class="k">@implementation</span> <span class="nc">PageView</span> <span class="o">:</span> <span class="nc">CPView</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></div>

<p>As you can see, <code>PageView</code> is a subclass of <code>CPView</code>, the core UI class
in Cappuccino. However, we will actually be doing the brunt of our
graphics work not in a view, but in a <code>layer</code>. In Cappuccino,
<code>CALayer</code>s are designed and optimized for drawing and performing complex
graphics routines, whereas <code>CPView</code>s are better at handling UI widgets.
We can add layers to views by making them <strong>layer-backed</strong>:</p>

<div class="highlight"><pre><span class="k">@implementation</span> <span class="nc">PageView</span> <span class="o">:</span> <span class="nc">CPView</span>
<span class="p">{</span>
    <span class="n">CALayer</span> <span class="n">_rootLayer</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithFrame:</span><span class="p">(</span><span class="kt">CGRect</span><span class="p">)</span>aFrame
<span class="p">{</span>
    <span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="n">initWithFrame</span><span class="o">:</span><span class="n">aFrame</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_rootLayer</span> <span class="o">=</span> <span class="p">[</span><span class="n">CALayer</span> <span class="n">layer</span><span class="p">];</span>

        <span class="p">[</span><span class="nb">self</span> <span class="n">setWantsLayer</span><span class="o">:</span><span class="kc">YES</span><span class="p">];</span>
        <span class="p">[</span><span class="nb">self</span> <span class="n">setLayer</span><span class="o">:</span><span class="n">_rootLayer</span><span class="p">];</span>

        <span class="p">[</span><span class="n">_rootLayer</span> <span class="n">setBackgroundColor</span><span class="o">:</span><span class="p">[</span><span class="n">CPColor</span> <span class="n">whiteColor</span><span class="p">]];</span>

        <span class="p">[</span><span class="n">_rootLayer</span> <span class="n">setNeedsDisplay</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></div>

<p>Here we create the view as usual, but let the view know that it will be
hosting a layer with the <code>setWantsLayer:</code> method, and adding the actual
layer with <code>setLayer:</code>. We give the layer a background color, but need
to call <code>setNeedsDisplay</code> for the layer to actually show itself. In
Cappuccino, you never explicitly tell views or layers to draw, instead
you inform them that they need to do so. This is because Cappuccino
coalesces and optimizes drawing.</p>

<p>As we said earlier, we now need a pane in this page. Pane’s hold images
as well as storing the scale and rotation properties of the image it
displays. We will be implementing panes as layers:</p>

<div class="highlight"><pre><span class="k">@implementation</span> <span class="nc">PaneLayer</span> <span class="o">:</span> <span class="nc">CALayer</span>
<span class="p">{</span>
    <span class="kt">float</span>       <span class="n">_rotationRadians</span><span class="p">;</span>
    <span class="kt">float</span>       <span class="n">_scale</span><span class="p">;</span>

    <span class="n">CPImage</span>     <span class="n">_image</span><span class="p">;</span>
    <span class="n">CALayer</span>     <span class="n">_imageLayer</span><span class="p">;</span>

    <span class="n">PageView</span>    <span class="n">_pageView</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithPageView:</span><span class="p">(</span><span class="kt">PageView</span><span class="p">)</span>aPageView
<span class="p">{</span>
    <span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="n">init</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_pageView</span> <span class="o">=</span> <span class="n">aPageView</span><span class="p">;</span>

        <span class="n">_rotationRadians</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
        <span class="n">_scale</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>

        <span class="n">_imageLayer</span> <span class="o">=</span> <span class="p">[</span><span class="n">CALayer</span> <span class="n">layer</span><span class="p">];</span>
        <span class="p">[</span><span class="n">_imageLayer</span> <span class="n">setDelegate</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>

        <span class="p">[</span><span class="nb">self</span> <span class="n">addSublayer</span><span class="o">:</span><span class="n">_imageLayer</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">PageView</span><span class="p">)</span><span class="nf">pageView</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">_pageView</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setBounds:</span><span class="p">(</span><span class="kt">CGRect</span><span class="p">)</span>aRect
<span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">setBounds</span><span class="o">:</span><span class="n">aRect</span><span class="p">];</span>

    <span class="p">[</span><span class="n">_imageLayer</span> <span class="n">setPosition</span><span class="o">:</span>
        <span class="nf">CGPointMake</span><span class="p">(</span><span class="nf">CGRectGetMidX</span><span class="p">(</span><span class="n">aRect</span><span class="p">),</span>
        <span class="nf">CGRectGetMidY</span><span class="p">(</span><span class="n">aRect</span><span class="p">))];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setImage:</span><span class="p">(</span><span class="kt">CPImage</span><span class="p">)</span>anImage
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_image</span> <span class="o">==</span> <span class="n">anImage</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">_image</span> <span class="o">=</span> <span class="n">anImage</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">_image</span><span class="p">)</span>
        <span class="p">[</span><span class="n">_imageLayer</span> <span class="n">setBounds</span><span class="o">:</span><span class="nf">CGRectMake</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="p">[</span><span class="n">_image</span> <span class="n">size</span><span class="p">].</span><span class="n">width</span><span class="p">,</span> <span class="p">[</span><span class="n">_image</span> <span class="n">size</span><span class="p">].</span><span class="n">height</span><span class="p">)];</span>

    <span class="p">[</span><span class="n">_imageLayer</span> <span class="n">setNeedsDisplay</span><span class="p">];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setRotationRadians:</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span>radians
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_rotationRadians</span> <span class="o">==</span> <span class="n">radians</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">_rotationRadians</span> <span class="o">=</span> <span class="n">radians</span><span class="p">;</span>

    <span class="p">[</span><span class="n">_imageLayer</span> <span class="n">setAffineTransform</span><span class="o">:</span><span class="nf">CGAffineTransformScale</span><span class="p">(</span>
        <span class="nf">CGAffineTransformMakeRotation</span><span class="p">(</span><span class="n">_rotationRadians</span><span class="p">),</span>
        <span class="n">_scale</span><span class="p">,</span> <span class="n">_scale</span><span class="p">)];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setScale:</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span>aScale
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_scale</span> <span class="o">==</span> <span class="n">aScale</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">_scale</span> <span class="o">=</span> <span class="n">aScale</span><span class="p">;</span>

    <span class="p">[</span><span class="n">_imageLayer</span> <span class="n">setAffineTransform</span><span class="o">:</span><span class="nf">CGAffineTransformScale</span><span class="p">(</span>
        <span class="nf">CGAffineTransformMakeRotation</span><span class="p">(</span><span class="n">_rotationRadians</span><span class="p">),</span>
        <span class="n">_scale</span><span class="p">,</span> <span class="n">_scale</span><span class="p">)];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">drawInContext:</span><span class="p">(</span><span class="kt">CGContext</span><span class="p">)</span>aContext
<span class="p">{</span>
    <span class="nf">CGContextSetFillColor</span><span class="p">(</span><span class="n">aContext</span><span class="p">,</span> <span class="p">[</span><span class="n">CPColor</span> <span class="n">grayColor</span><span class="p">]);</span>
    <span class="nf">CGContextFillRect</span><span class="p">(</span><span class="n">aContext</span><span class="p">,</span> <span class="p">[</span><span class="nb">self</span> <span class="n">bounds</span><span class="p">]);</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">imageDidLoad:</span><span class="p">(</span><span class="kt">CPImage</span><span class="p">)</span>anImage
<span class="p">{</span>
    <span class="p">[</span><span class="n">_imageLayer</span> <span class="n">setNeedsDisplay</span><span class="p">];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">drawLayer:</span><span class="p">(</span><span class="kt">CALayer</span><span class="p">)</span>aLayer <span class="nf">inContext:</span><span class="p">(</span><span class="kt">CGContext</span><span class="p">)</span>aContext
<span class="p">{</span>
    <span class="kd">var</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">aLayer</span> <span class="n">bounds</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">([</span><span class="n">_image</span> <span class="n">loadStatus</span><span class="p">]</span> <span class="o">!=</span>
        <span class="n">CPImageLoadStatusCompleted</span><span class="p">)</span>
        <span class="p">[</span><span class="n">_image</span> <span class="n">setDelegate</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>
    <span class="k">else</span>
        <span class="nf">CGContextDrawImage</span><span class="p">(</span><span class="n">aContext</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">_image</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></div>

<p>That’s the entire <code>PaneLayer</code> class and it’s pretty straight forward. I
just put it in <code>PageView.j</code> for now right before the implementation of
<code>PageView</code>. You can choose put it in a separate file, but don’t forget
to import it in <code>PageView.j</code> if you do.</p>

<p>Let’s start by looking at the insance variables. As I said, the pane
layer keeps an image, rotation, and scale, represented here by
<code>_image</code>, <code>_rotationRadians</code>, and <code>_scale</code>. We have two
additional members though: <code>_imageLayer</code>, which we will use to draw
the image, and <code>_pageView</code>, which just gives us a reference to our
owning page.</p>

<p>In <code>initWithPageView:</code> we set up our default values. Clearly we’d like
the image to start off unrotated and unscaled. We also create our
internal <code>_imageLayer</code> and set ourselves to be the <code>delegate</code> with
<code>setDelegate:</code>. Delegates are an important concept in Cappuccino,
because they allow you to modify the behavior of classes without having
to subclass them. Many classes in Cappuccino allow you to supply a
delegate, and then call several methods on that delegate. In this case,
we set ourselves as the delegate of the image layer class because we
want to implement <code>drawLayer:inContext:</code></p>

<div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">drawLayer:</span><span class="p">(</span><span class="kt">CALayer</span><span class="p">)</span>aLayer <span class="nf">inContext:</span><span class="p">(</span><span class="kt">CGContext</span><span class="p">)</span>aContext
<span class="p">{</span>
    <span class="kd">var</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">aLayer</span> <span class="n">bounds</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">([</span><span class="n">_image</span> <span class="n">loadStatus</span><span class="p">]</span> <span class="o">!=</span> <span class="n">CPImageLoadStatusCompleted</span><span class="p">)</span>
        <span class="p">[</span><span class="n">_image</span> <span class="n">setDelegate</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>
    <span class="k">else</span>
        <span class="nf">CGContextDrawImage</span><span class="p">(</span><span class="n">aContext</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">_image</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>This <strong>delegate method</strong> allows another class to draw within the
<code>_imageLayer</code>. In this case all we’re doing is drawing our image into
the layer. <code>aContext</code> is the drawing context of the layer in question,
and we use <code>CGContextDrawImage</code> to render <code>_image</code> to the rectangle
<code>bounds</code>. This just means that we always want the image to fit the
entire width and height of the layer. Notice that we use delegates once
more though: If the image hasn’t completed loading, we set ourselves as
the delegate of the image. Once the image has completed loading, it will
send its delegate the <code>imageDidLoad:</code> message:</p>

<div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">imageDidLoad:</span><span class="p">(</span><span class="kt">CPImage</span><span class="p">)</span>anImage
<span class="p">{</span>
    <span class="p">[</span><span class="n">_imageLayer</span> <span class="n">setNeedsDisplay</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>So once the image has completed loading, we just tell our
<code>_imageLayer</code> that it needs to redisplay itself because it has new
information to show. The other drawing function we have is the layer’s
own <code>drawInContext:</code>, where all we do is draw gray since this will be
the background color of our pane.</p>

<p>The rest of the methods are now prety straight forward since they are
just <strong>setters</strong> and <strong>getters</strong> for our existing properties. We supply
the <code>pageView</code> method to allow one to get the owning page view. We
override <code>setBounds:</code> to keep the internal <code>_imageLayer</code> centered,
and we use <code>setImage:</code> to set the image of the layer:</p>

<div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setImage:</span><span class="p">(</span><span class="kt">CPImage</span><span class="p">)</span>anImage
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_image</span> <span class="o">==</span> <span class="n">anImage</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">_image</span> <span class="o">=</span> <span class="n">anImage</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">_image</span><span class="p">)</span>
        <span class="p">[</span><span class="n">_imageLayer</span> <span class="n">setBounds</span><span class="o">:</span><span class="nf">CGRectMake</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="p">[</span><span class="n">_image</span> <span class="n">size</span><span class="p">].</span><span class="n">width</span><span class="p">,</span> <span class="p">[</span><span class="n">_image</span> <span class="n">size</span><span class="p">].</span><span class="n">height</span><span class="p">)];</span>

    <span class="p">[</span><span class="n">_imageLayer</span> <span class="n">setNeedsDisplay</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>We use the information from the image to set the size of the
<code>_imageLayer</code>, since we want them to match. We also once again inform
our <code>_imageLayer</code> that it needs to redraw because it now has a new
image.</p>

<p>The last two methods are the most interesting and where the magic
happens. Both <code>setScale:</code> and <code>setRotationRadians:</code> use the built in
transformation methods to adjust the <code>_imageLayer</code>. In both cases we
simply take our two values and create a <code>transform</code> with them. This is
all that is necessary in Cappuccino to rotate and scale layers.</p>

<div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setRotationRadians:</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span>radians
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_rotationRadians</span> <span class="o">==</span> <span class="n">radians</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">_rotationRadians</span> <span class="o">=</span> <span class="n">radians</span><span class="p">;</span>

    <span class="p">[</span><span class="n">_imageLayer</span> <span class="n">setAffineTransform</span><span class="o">:</span><span class="nf">CGAffineTransformScale</span><span class="p">(</span>
        <span class="nf">CGAffineTransformMakeRotation</span><span class="p">(</span><span class="n">_rotationRadians</span><span class="p">),</span>
        <span class="n">_scale</span><span class="p">,</span> <span class="n">_scale</span><span class="p">)];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setScale:</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span>aScale
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_scale</span> <span class="o">==</span> <span class="n">aScale</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">_scale</span> <span class="o">=</span> <span class="n">aScale</span><span class="p">;</span>

    <span class="p">[</span><span class="n">_imageLayer</span> <span class="n">setAffineTransform</span><span class="o">:</span><span class="nf">CGAffineTransformScale</span><span class="p">(</span>
        <span class="nf">CGAffineTransformMakeRotation</span><span class="p">(</span><span class="n">_rotationRadians</span><span class="p">),</span>
        <span class="n">_scale</span><span class="p">,</span> <span class="n">_scale</span><span class="p">)];</span>
<span class="p">}</span>
</pre></div>

<p>Let’s now go ahead and create a simple pane within our page view:</p>

<div class="highlight"><pre><span class="k">@implementation</span> <span class="nc">PageView</span> <span class="o">:</span> <span class="nc">CPView</span>
<span class="p">{</span>
    <span class="n">CALayer</span>     <span class="n">_rootLayer</span><span class="p">;</span>

    <span class="n">PaneLayer</span>   <span class="n">_paneLayer</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithFrame:</span><span class="p">(</span><span class="kt">CGRect</span><span class="p">)</span>aFrame
<span class="p">{</span>
    <span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="n">initWithFrame</span><span class="o">:</span><span class="n">aFrame</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_rootLayer</span> <span class="o">=</span> <span class="p">[</span><span class="n">CALayer</span> <span class="n">layer</span><span class="p">];</span>

        <span class="p">[</span><span class="nb">self</span> <span class="n">setWantsLayer</span><span class="o">:</span><span class="kc">YES</span><span class="p">];</span>
        <span class="p">[</span><span class="nb">self</span> <span class="n">setLayer</span><span class="o">:</span><span class="n">_rootLayer</span><span class="p">];</span>

        <span class="p">[</span><span class="n">_rootLayer</span> <span class="n">setBackgroundColor</span><span class="o">:</span>
            <span class="p">[</span><span class="n">CPColor</span> <span class="n">whiteColor</span><span class="p">]];</span>

        <span class="n">_paneLayer</span> <span class="o">=</span> <span class="p">[[</span><span class="n">PaneLayer</span> <span class="n">alloc</span><span class="p">]</span>
            <span class="n">initWithPageView</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>

        <span class="p">[</span><span class="n">_paneLayer</span> <span class="n">setBounds</span><span class="o">:</span><span class="nf">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
            <span class="mi">400</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">40</span><span class="p">,</span> <span class="mf">400.</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)];</span>
        <span class="p">[</span><span class="n">_paneLayer</span> <span class="n">setAnchorPoint</span><span class="o">:</span><span class="nf">CGPointMakeZero</span><span class="p">()];</span>
        <span class="p">[</span><span class="n">_paneLayer</span> <span class="n">setPosition</span><span class="o">:</span><span class="nf">CGPointMake</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">)];</span>

        <span class="p">[</span><span class="n">_paneLayer</span> <span class="n">setImage</span><span class="o">:</span><span class="p">[[</span><span class="n">CPImage</span> <span class="n">alloc</span><span class="p">]</span>
            <span class="n">initWithContentsOfFile</span><span class="o">:</span>
            <span class="s">@"Resources/sample.jpg"</span>
            <span class="n">size</span><span class="o">:</span><span class="nf">CGSizeMake</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">430</span><span class="p">)]];</span>

        <span class="p">[</span><span class="n">_rootLayer</span> <span class="n">addSublayer</span><span class="o">:</span><span class="n">_paneLayer</span><span class="p">];</span>

        <span class="p">[</span><span class="n">_paneLayer</span> <span class="n">setNeedsDisplay</span><span class="p">];</span>

        <span class="p">[</span><span class="n">_rootLayer</span> <span class="n">setNeedsDisplay</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></div>

<p>For now we are just going to use a default image for our pane, which you
can download <a href="https://raw.github.com/cappuccino/cappuccino-demos/master/Scrapbook/Part%201/Resources/sample.jpg">here</a> and put into a
folder called “Resources”. We set the size of the <code>_paneLayer</code> with
<code>setBounds:</code>, and the position of the layer with a combination of
<code>setAnchorPoint:</code> and <code>setPosition:</code>. This is because unlike <code>CPView</code>s,
by default the <code>position</code> of a <code>CALayer</code> refers to the position of its
center point. To make the <code>position</code> refer to the top left corner, we
have to specify an achor point of <strong>(0.0, 0.0)</strong>.</p>

<h3>Wrapping Up</h3>

<p>We are now almost done with our application. All that is left is to
bring together the photo inspector and the page view. The photo
inspector will essentially “edit” the page views, so let’s add the
following code after <code>[_rootLayer addSublayer:_paneLayer]</code> in
<code>initWithFrame:</code></p>

<div class="highlight"><pre><span class="n">_borderLayer</span> <span class="o">=</span> <span class="p">[</span><span class="n">CALayer</span> <span class="n">layer</span><span class="p">];</span>

<span class="p">[</span><span class="n">_borderLayer</span> <span class="n">setAnchorPoint</span><span class="o">:</span><span class="nf">CGPointMakeZero</span><span class="p">()];</span>
<span class="p">[</span><span class="n">_borderLayer</span> <span class="n">setBounds</span><span class="o">:</span><span class="p">[</span><span class="nb">self</span> <span class="n">bounds</span><span class="p">]];</span>
<span class="p">[</span><span class="n">_borderLayer</span> <span class="n">setDelegate</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>

<span class="p">[</span><span class="n">_rootLayer</span> <span class="n">addSublayer</span><span class="o">:</span><span class="n">_borderLayer</span><span class="p">];</span>
</pre></div>

<p>Also add <code>_borderLayer</code> to PageView’s declaration:</p>

<div class="highlight"><pre><span class="k">@implementation</span> <span class="nc">PageView</span> <span class="o">:</span> <span class="nc">CPView</span>
<span class="p">{</span>
    <span class="n">CALayer</span>     <span class="n">_borderLayer</span><span class="p">;</span>
    <span class="n">CALayer</span>     <span class="n">_rootLayer</span><span class="p">;</span>

    <span class="n">PaneLayer</span>   <span class="n">_paneLayer</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>The border layer is meant to draw the borders of the panes. Once again
we are making ourselves the delegate of <code>_borderLayer</code>, so add
<code>drawLayer:inContext:</code> to <code>PageView</code></p>

<div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">drawLayer:</span><span class="p">(</span><span class="kt">CALayer</span><span class="p">)</span>aLayer <span class="nf">inContext:</span><span class="p">(</span><span class="kt">CGContext</span><span class="p">)</span>aContext
<span class="p">{</span>
    <span class="nf">CGContextSetFillColor</span><span class="p">(</span><span class="n">aContext</span><span class="p">,</span> <span class="p">[</span><span class="n">CPColor</span> <span class="n">whiteColor</span><span class="p">]);</span>

    <span class="kd">var</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">aLayer</span> <span class="n">bounds</span><span class="p">],</span>
        <span class="n">width</span> <span class="o">=</span> <span class="nf">CGRectGetWidth</span><span class="p">(</span><span class="n">bounds</span><span class="p">),</span>
        <span class="n">height</span> <span class="o">=</span> <span class="nf">CGRectGetHeight</span><span class="p">(</span><span class="n">bounds</span><span class="p">);</span>

    <span class="nf">CGContextFillRect</span><span class="p">(</span><span class="n">aContext</span><span class="p">,</span> <span class="nf">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">40</span><span class="p">));</span>
    <span class="nf">CGContextFillRect</span><span class="p">(</span><span class="n">aContext</span><span class="p">,</span> <span class="nf">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span>
        <span class="mi">40</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">40</span><span class="p">));</span>
    <span class="nf">CGContextFillRect</span><span class="p">(</span><span class="n">aContext</span><span class="p">,</span> <span class="nf">CGRectMake</span><span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span>
        <span class="mi">40</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">40</span><span class="p">));</span>
    <span class="nf">CGContextFillRect</span><span class="p">(</span><span class="n">aContext</span><span class="p">,</span> <span class="nf">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">40</span><span class="p">,</span>
        <span class="n">width</span><span class="p">,</span> <span class="mi">40</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>

<p>Here we are just drawing a few white-filled rectangles to be the borders
of our internal pane. We can now add a new method called <code>setEditing:</code>
to our page view:</p>

<div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setEditing:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span>isEditing
<span class="p">{</span>
    <span class="p">[</span><span class="n">_borderLayer</span> <span class="n">setOpacity</span><span class="o">:</span><span class="n">isEditing</span> <span class="o">?</span> <span class="mf">0.5</span> <span class="o">:</span> <span class="mf">1.0</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>What this method does is make the border of our pane semi-transparent
when we are editing. That way as you scale and rotate you can still see
much of the full image despite it being “inside” the pane.</p>

<p>We will now return to our <code>PhotoInspector</code> class to make it aware of
these two new classes we’ve created. Start by adding a <code>PaneLayer</code> to
the <code>PhotoInspector</code> declaration:</p>

<div class="highlight"><pre><span class="cp">@import</span> <span class="s2">&lt;AppKit/CPWindowController.j&gt;</span>
<span class="cp">@import</span> <span class="s2">"PageView.j"</span>

<span class="k">@implementation</span> <span class="nc">PhotoInspector</span> <span class="o">:</span> <span class="nc">CPWindowController</span>
<span class="p">{</span>
    <span class="n">CPSlider</span>    <span class="n">_scaleSlider</span><span class="p">;</span>
    <span class="n">CPSlider</span>    <span class="n">_rotationSlider</span><span class="p">;</span>

    <span class="n">PaneLayer</span>   <span class="n">_paneLayer</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Now let’s add a few methods to make the PhotoInspector a <code>singleton</code>,
since there’s only ever one used in the application:</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="n">PhotoInspectorSharedInstance</span>    <span class="o">=</span> <span class="kc">nil</span><span class="p">;</span>

<span class="k">@implementation</span> <span class="nc">PhotoInspector</span> <span class="o">:</span> <span class="nc">CPWindowController</span>
<span class="p">{</span>
    <span class="n">CPSlider</span>    <span class="n">_scaleSlider</span><span class="p">;</span>
    <span class="n">CPSlider</span>    <span class="n">_rotationSlider</span><span class="p">;</span>

    <span class="n">PaneLayer</span>   <span class="n">_paneLayer</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">+</span> <span class="p">(</span><span class="kt">PhotoInspector</span><span class="p">)</span><span class="nf">sharedPhotoInspector</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PhotoInspectorSharedInstance</span><span class="p">)</span>
        <span class="n">PhotoInspectorSharedInstance</span> <span class="o">=</span> <span class="p">[[</span><span class="n">PhotoInspector</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>

    <span class="k">return</span> <span class="n">PhotoInspectorSharedInstance</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>You can now get at the shared <code>PhotoInspector</code> instance by calling
<code>[PhotoInspector sharedPhotoInspector]</code>. Notice that this method begins
with a plus instead of a minus. That’s because this is a <strong>class
method</strong>. Also, we declared a <strong>file local</strong> variable to store the
shared instance at the top with this line:</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="n">PhotoInspectorSharedInstance</span>    <span class="o">=</span> <span class="kc">nil</span><span class="p">;</span>
</pre></div>

<p>Unlike JavaScript, varing variables in a file does trap them in that
file’s scope, so this variable will only be accessible through the
<code>sharedPhotoInspector</code> method.</p>

<p>We will now add the setter for the <code>_paneLayer</code> member, which
represents the pane and image that the photo inspector is currently
inspecting:</p>

<div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setPaneLayer:</span><span class="p">(</span><span class="kt">PaneLayer</span><span class="p">)</span>anPaneLayer
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_paneLayer</span> <span class="o">==</span> <span class="n">anPaneLayer</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="p">[[</span><span class="n">_paneLayer</span> <span class="n">pageView</span><span class="p">]</span> <span class="n">setEditing</span><span class="o">:</span><span class="kc">NO</span><span class="p">];</span>

    <span class="n">_paneLayer</span> <span class="o">=</span> <span class="n">anPaneLayer</span><span class="p">;</span>

    <span class="kd">var</span> <span class="n">page</span> <span class="o">=</span> <span class="p">[</span><span class="n">_paneLayer</span> <span class="n">pageView</span><span class="p">];</span>

    <span class="p">[</span><span class="n">page</span> <span class="n">setEditing</span><span class="o">:</span><span class="kc">YES</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">_paneLayer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="n">frame</span> <span class="o">=</span> <span class="p">[</span><span class="n">page</span> <span class="n">convertRect</span><span class="o">:</span><span class="p">[</span><span class="n">page</span> <span class="n">bounds</span><span class="p">]</span> <span class="n">toView</span><span class="o">:</span><span class="kc">nil</span><span class="p">],</span>
            <span class="n">windowSize</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">self</span> <span class="nb">window</span><span class="p">]</span> <span class="n">frame</span><span class="p">].</span><span class="n">size</span><span class="p">;</span>

        <span class="p">[[</span><span class="nb">self</span> <span class="nb">window</span><span class="p">]</span> <span class="n">setFrameOrigin</span><span class="o">:</span>
            <span class="nf">CGPointMake</span><span class="p">(</span><span class="nf">CGRectGetMidX</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="o">-</span>
            <span class="n">windowSize</span><span class="p">.</span><span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="nf">CGRectGetMidY</span><span class="p">(</span><span class="n">frame</span><span class="p">))];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As you can see, when we pass in a new pane layer, we first do a little
bit of cleanup on our old pane layer if we have one. We tell its
corresponding page view that we are no longer editing, and then tell the
new pane layer’s page view that we are editing (thus dimming the border
described above). We then position our window at the center of the pane.</p>

<p>Let’s actually make our two sliders useful now by giving them
<code>targets</code> and <code>actions</code> in our <code>init</code> method after they are created:</p>

<div class="highlight"><pre><span class="p">[</span><span class="n">rotationSlider</span> <span class="n">setTarget</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>
<span class="p">[</span><span class="n">rotationSlider</span> <span class="n">setAction</span><span class="o">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">rotate</span><span class="o">:</span><span class="p">)];</span>
</pre></div>

<blockquote>
</blockquote>

<div class="highlight"><pre><span class="p">[</span><span class="n">scaleSlider</span> <span class="n">setTarget</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>
<span class="p">[</span><span class="n">scaleSlider</span> <span class="n">setAction</span><span class="o">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">scale</span><span class="o">:</span><span class="p">)];</span>
</pre></div>

<p>Targets and actions are kind of like callbacks, but object-oriented and
much more powerful. Instead of supplying a callback <code>function</code>, you
supply both a callback object, or target, and a callback method to call
on that object. In this case, when we move the <code>rotationSlider</code>, we
will have <code>rotate:</code> called on <code>self</code> (the <code>PhotoInspector</code> instance),
and when we move the <code>scaleSlider</code>, <code>scale:</code> will be called.</p>

<p>We of course must implement <code>scale:</code> and <code>rotate:</code> in <code>PhotoInspector</code>
for this to be useful at all:</p>

<div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">scale:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span>aSender
<span class="p">{</span>
    <span class="p">[</span><span class="n">_paneLayer</span> <span class="n">setScale</span><span class="o">:</span><span class="p">[</span><span class="n">aSender</span> <span class="n">value</span><span class="p">]</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">rotate:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span>aSender
<span class="p">{</span>
    <span class="p">[</span><span class="n">_paneLayer</span> <span class="n">setRotationRadians</span><span class="o">:</span><span class="kc">PI</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="p">[</span><span class="n">aSender</span> <span class="n">value</span><span class="p">]];</span>
<span class="p">}</span>
</pre></div>

<p>All we do in these two methods is make use of the setters we implemented
in the <code>PaneLayer</code> class. You might have noticed that our code is
curiously devoid of the null-checks you so often find in JavaScript,
Java, C++, etc. That’s because Objective-J just ignores messages sent to
nil, so instead of having to do:</p>

<div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="n">myObject</span><span class="p">)</span>
    <span class="p">[</span><span class="n">myObject</span> <span class="n">method</span><span class="p">];</span>
</pre></div>

<p>You can safely do:</p>

<div class="highlight"><pre><span class="p">[</span><span class="n">myObject</span> <span class="n">method</span><span class="p">];</span>
</pre></div>

<p>We are going to add two more methods to PhotoInspector to complete it:</p>

<div class="highlight"><pre><span class="o">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">inspectPaneLayer:</span><span class="p">(</span><span class="kt">PaneLayer</span><span class="p">)</span>anPaneLayer
<span class="p">{</span>
    <span class="kd">var</span> <span class="n">inspector</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="n">sharedPhotoInspector</span><span class="p">];</span>

    <span class="p">[</span><span class="n">inspector</span> <span class="n">setPaneLayer</span><span class="o">:</span><span class="n">anPaneLayer</span><span class="p">];</span>

    <span class="p">[</span><span class="n">inspector</span> <span class="n">showWindow</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">windowWillClose:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span>aSender
<span class="p">{</span>
    <span class="p">[</span><span class="nb">self</span> <span class="n">setPaneLayer</span><span class="o">:</span><span class="kc">nil</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>The first just provides a shorthand for bringing up the inspector and
telling it to inspect a certain <code>PaneLayer</code>. The second handles the case
when the inspector window is closed: we certainly don’t want to leave
the currently editing pane in editing mode, so we set our editing pane
to be <code>nil</code>. However, to receive the <code>windowDidCLose:</code> method, we must
make ourselves the delegate of our window, which we can do in the init
method:</p>

<div class="highlight"><pre><span class="c1">//...</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">theWindow</span> <span class="n">setTitle</span><span class="o">:</span><span class="s">@"Inspector"</span><span class="p">];</span>
    <span class="p">[</span><span class="n">theWindow</span> <span class="n">setFloatingPanel</span><span class="o">:</span><span class="kc">YES</span><span class="p">];</span>

    <span class="p">[</span><span class="n">theWindow</span> <span class="n">setDelegate</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>
<span class="c1">//...</span>
</pre></div>

<p>Our <code>PhotoInspector</code> is now complete, we just need to bring it up when
we double click on our page view. To do this, let’s return to the
PageView class and add a <code>mouseDown:</code> method:</p>

<div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">mouseDown:</span><span class="p">(</span><span class="kt">CPEvent</span><span class="p">)</span>anEvent
<span class="p">{</span>
    <span class="k">if</span> <span class="p">([</span><span class="n">anEvent</span> <span class="n">clickCount</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">[</span><span class="n">PhotoInspector</span> <span class="n">inspectPaneLayer</span><span class="o">:</span><span class="n">_paneLayer</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>There is no need to register for events in Cappuccino as you might do in
JavaScript, simply implement on of the event handling methods such as
<code>mouseDown:</code> and you will receive the event. Here, we simply check the
click count of the mouse down event and inspect our single pange if it
is a double click.</p>

<p>To finish this application, put the following in your
<code>applicationDidFinishLaunching:</code> to make a sample <code>PageView</code>:</p>

<div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">applicationDidFinishLaunching:</span><span class="p">(</span><span class="kt">CPNotification</span><span class="p">)</span>aNotification
<span class="p">{</span>
    <span class="kd">var</span> <span class="n">theWindow</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPWindow</span> <span class="n">alloc</span><span class="p">]</span>
            <span class="n">initWithContentRect</span><span class="o">:</span><span class="nf">CGRectMakeZero</span><span class="p">()</span>
            <span class="n">styleMask</span><span class="o">:</span><span class="n">CPBorderlessBridgeWindowMask</span><span class="p">],</span>
        <span class="n">contentView</span> <span class="o">=</span> <span class="p">[</span><span class="n">theWindow</span> <span class="n">contentView</span><span class="p">];</span>

    <span class="p">[</span><span class="n">contentView</span> <span class="n">setBackgroundColor</span><span class="o">:</span><span class="p">[</span><span class="n">CPColor</span> <span class="n">blackColor</span><span class="p">]];</span>

    <span class="p">[</span><span class="n">theWindow</span> <span class="n">orderFront</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>

    <span class="kd">var</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">contentView</span> <span class="n">bounds</span><span class="p">],</span>
        <span class="n">pageView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">PageView</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">initWithFrame</span><span class="o">:</span>
            <span class="nf">CGRectMake</span><span class="p">(</span><span class="nf">CGRectGetWidth</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="o">-</span> <span class="mi">200</span><span class="p">,</span> <span class="nf">CGRectGetHeight</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">200</span><span class="p">,</span>
            <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">)];</span>

    <span class="p">[</span><span class="n">pageView</span> <span class="n">setAutoresizingMask</span><span class="o">:</span>  <span class="n">CPViewMinXMargin</span> <span class="o">|</span>
                                    <span class="n">CPViewMaxXMargin</span> <span class="o">|</span>
                                    <span class="n">CPViewMinYMargin</span> <span class="o">|</span>
                                    <span class="n">CPViewMaxYMargin</span><span class="p">];</span>

    <span class="p">[</span><span class="n">contentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">pageView</span><span class="p">];</span>

    <span class="kd">var</span> <span class="n">label</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPTextField</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">initWithFrame</span><span class="o">:</span><span class="nf">CGRectMakeZero</span><span class="p">()];</span>

    <span class="p">[</span><span class="n">label</span> <span class="n">setTextColor</span><span class="o">:</span><span class="p">[</span><span class="n">CPColor</span> <span class="n">whiteColor</span><span class="p">]];</span>
    <span class="p">[</span><span class="n">label</span> <span class="n">setStringValue</span><span class="o">:</span><span class="s">@"Double Click to Edit Photo"</span><span class="p">];</span>

    <span class="p">[</span><span class="n">label</span> <span class="n">sizeToFit</span><span class="p">];</span>
    <span class="p">[</span><span class="n">label</span> <span class="n">setFrameOrigin</span><span class="o">:</span><span class="nf">CGPointMake</span><span class="p">(</span><span class="nf">CGRectGetWidth</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span>
        <span class="nf">CGRectGetWidth</span><span class="p">([</span><span class="n">label</span> <span class="n">frame</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="nf">CGRectGetMinY</span><span class="p">([</span><span class="n">pageView</span> <span class="n">frame</span><span class="p">])</span> <span class="o">-</span>
        <span class="nf">CGRectGetHeight</span><span class="p">([</span><span class="n">label</span> <span class="n">frame</span><span class="p">]))];</span>
    <span class="p">[</span><span class="n">label</span> <span class="n">setAutoresizingMask</span><span class="o">:</span> <span class="n">CPViewMinXMargin</span> <span class="o">|</span>
                                <span class="n">CPViewMaxXMargin</span> <span class="o">|</span>
                                <span class="n">CPViewMinYMargin</span> <span class="o">|</span>
                                <span class="n">CPViewMaxYMargin</span><span class="p">];</span>

    <span class="p">[</span><span class="n">contentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">label</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>Your <code>AppController.j</code> should now look something like this:</p>

<div class="highlight"><pre><span class="cp">@import</span> <span class="s2">&lt;Foundation/CPObject.j&gt;</span>

<span class="cp">@import</span> <span class="s2">"PageView.j"</span>
<span class="cp">@import</span> <span class="s2">"PhotoInspector.j"</span>


<span class="k">@implementation</span> <span class="nc">AppController</span> <span class="o">:</span> <span class="nc">CPObject</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">applicationDidFinishLaunching:</span><span class="p">(</span><span class="kt">CPNotification</span><span class="p">)</span>aNotification
<span class="p">{</span>
    <span class="kd">var</span> <span class="n">theWindow</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPWindow</span> <span class="n">alloc</span><span class="p">]</span>
            <span class="n">initWithContentRect</span><span class="o">:</span><span class="nf">CGRectMakeZero</span><span class="p">()</span>
            <span class="n">styleMask</span><span class="o">:</span><span class="n">CPBorderlessBridgeWindowMask</span><span class="p">],</span>
        <span class="n">contentView</span> <span class="o">=</span> <span class="p">[</span><span class="n">theWindow</span> <span class="n">contentView</span><span class="p">];</span>

    <span class="p">[</span><span class="n">contentView</span> <span class="n">setBackgroundColor</span><span class="o">:</span><span class="p">[</span><span class="n">CPColor</span> <span class="n">blackColor</span><span class="p">]];</span>

    <span class="p">[</span><span class="n">theWindow</span> <span class="n">orderFront</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>

    <span class="kd">var</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">contentView</span> <span class="n">bounds</span><span class="p">],</span>
        <span class="n">pageView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">PageView</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">initWithFrame</span><span class="o">:</span>
            <span class="nf">CGRectMake</span><span class="p">(</span><span class="nf">CGRectGetWidth</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="o">-</span> <span class="mi">200</span><span class="p">,</span> <span class="nf">CGRectGetHeight</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">200</span><span class="p">,</span>
            <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">)];</span>

    <span class="p">[</span><span class="n">pageView</span> <span class="n">setAutoresizingMask</span><span class="o">:</span>  <span class="n">CPViewMinXMargin</span> <span class="o">|</span>
                                    <span class="n">CPViewMaxXMargin</span> <span class="o">|</span>
                                    <span class="n">CPViewMinYMargin</span> <span class="o">|</span>
                                    <span class="n">CPViewMaxYMargin</span><span class="p">];</span>

    <span class="p">[</span><span class="n">contentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">pageView</span><span class="p">];</span>

    <span class="kd">var</span> <span class="n">label</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPTextField</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">initWithFrame</span><span class="o">:</span><span class="nf">CGRectMakeZero</span><span class="p">()];</span>

    <span class="p">[</span><span class="n">label</span> <span class="n">setTextColor</span><span class="o">:</span><span class="p">[</span><span class="n">CPColor</span> <span class="n">whiteColor</span><span class="p">]];</span>
    <span class="p">[</span><span class="n">label</span> <span class="n">setStringValue</span><span class="o">:</span><span class="s">@"Double Click to Edit Photo"</span><span class="p">];</span>

    <span class="p">[</span><span class="n">label</span> <span class="n">sizeToFit</span><span class="p">];</span>
    <span class="p">[</span><span class="n">label</span> <span class="n">setFrameOrigin</span><span class="o">:</span><span class="nf">CGPointMake</span><span class="p">(</span><span class="nf">CGRectGetWidth</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span>
        <span class="nf">CGRectGetWidth</span><span class="p">([</span><span class="n">label</span> <span class="n">frame</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="nf">CGRectGetMinY</span><span class="p">([</span><span class="n">pageView</span> <span class="n">frame</span><span class="p">])</span> <span class="o">-</span>
        <span class="nf">CGRectGetHeight</span><span class="p">([</span><span class="n">label</span> <span class="n">frame</span><span class="p">]))];</span>
    <span class="p">[</span><span class="n">label</span> <span class="n">setAutoresizingMask</span><span class="o">:</span> <span class="n">CPViewMinXMargin</span> <span class="o">|</span>
                                <span class="n">CPViewMaxXMargin</span> <span class="o">|</span>
                                <span class="n">CPViewMinYMargin</span> <span class="o">|</span>
                                <span class="n">CPViewMaxYMargin</span><span class="p">];</span>

    <span class="p">[</span><span class="n">contentView</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">label</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></div>

<h3>Conclusion</h3>

<p>This concludes our first tutorial. We’ve gotten familiar with some of
the drawing and event constructs of Cappuccino and have put together a
pretty simple prototype of our Scrapbook application. Next time, we’ll
be going deeper into events and drag and drop to start making our
application more useful.</p>

<p>Something you may have noticed is that we never once spoke about browser
inconsistencies, nor do we have any conditional code based on what
browser the user is on. Since all the constructs we use are from
Cappuccino, we shift all the heavy lifting of these sorts of tasks to
the framework, and can instead focus on the key features of our
application.</p>

</div>
</div>
<div class="row">
<div class="offset3 span9">
<div class="learn-nav">
<ul class="pager">
<li class="previous">
<a href="/learn/objective-j.html">← Return to '
Learning Objective-J
'
</a>
</li>
<li class="next">
<a href="/learn/scrapbook-2.html">Continue to '
Scrapbook #2 - Drag and Drop
' →
</a>
</li>
</ul>
</div>
</div>
</div>
</div>

<div id="footer">
<div class="container">
<div class="row">
<div class="span6 links">
<h3>Links</h3>
<div class="row">
<div class="span2">
<h4>Get Started</h4>
<a href="/#features">Features</a>
<a href="/learn/">Tutorials</a>
<a href="/downloads.html">Download</a>
<a href="/learn/documentation/">API Docs</a>
</div>
<div class="span2">
<h4>Contribute</h4>
<a></a>
<a href="/contribute.html#bug-reports">Bug reports</a>
<a href="https://github.com/cappuccino/cappuccino">Source code</a>
<a href="https://github.com/cappuccino/cappuccino/wiki">Wiki</a>
<a href="https://gratipay.com/cappuccino/">Donate</a>
</div>
<div class="span2">
<h4>Get Answers</h4>
<a href="/support/">Support</a>
<a href="http://groups.google.com/group/objectivej">Mailing list</a>
<a href="https://gitter.im/cappuccino/cappuccino">Cappuccino Gitter</a>
<a href="/blog/">Blog</a>
<a href="/support/faq.html">FAQ</a>
<a href="http://www.meetup.com/World-Cappuccino-Meetup/">Meetup</a>
</div>
</div>
</div>
<div class="span6 stats">
<h3>Project Stats</h3>
<div class="row">
<div class="span2">
<h4>Build</h4>
<a href="https://travis-ci.org/cappuccino/cappuccino"><img src="https://travis-ci.org/cappuccino/cappuccino.png?branch=master">
</a>
</div>
</div>
</div>
</div>
<hr>
<div class="row copyright">
<div class="span2">
<h3>Social</h3>
<a class="social tw" href="https://twitter.com/cappuccino">
<i class="i_twitter"></i>
</a>
</div>
<div class="span8 copyright2">
<p><img width="18" height="13" src="/img/minisofa-4aa3e405.png"> Logo by <a href="http://madebysofa.com">Sofa</a>. Hosted by <a href="http://slevenbits.com">SlevenBits</a>. Copyright © 2013-2019 - Cappuccino Project.</p>
</div>
<div class="pull-right forkme">
<p>
<a href="https://github.com/cappuccino/cappuccino.org">Fork and edit this site.</a>
</p>
</div>
</div>

</div>
</div>
<script src="https://code.jquery.com/jquery-latest.js"></script>
<script src="/js/bootstrap.min-f6d9c45d.js"></script>
<script src="/js/theme-09250c02.js"></script>
</body>
</html>
